# API Documentation

_Complete API reference for Image Studio's REST endpoints_

---

**Author:** Hazem Ali, Microsoft AI MVP  
**Repository:** [Image Studio](https://github.com/DrHazemAli/image-studio)  
**Documentation:** [Wiki](https://github.com/DrHazemAli/image-studio/wiki)

[![GitHub](https://img.shields.io/badge/GitHub-DrHazemAli-blue)](https://github.com/DrHazemAli)
[![LinkedIn](https://img.shields.io/badge/LinkedIn-hazemali-blue)](https://linkedin.com/in/drhazemali)
[![MVP](https://img.shields.io/badge/Microsoft-AI%20MVP-blue)](https://mvp.microsoft.com/)

---

## üéØ Overview

Image Studio provides a comprehensive REST API built on Next.js App Router, offering endpoints for image generation, asset management, configuration, and authentication. All endpoints are designed to work seamlessly with the web interface and CLI tools.

## üîê Authentication

### Authentication Methods

The API supports multiple authentication methods:

#### Cookie-Based Authentication

- **Method**: HTTP cookies with encrypted configuration
- **Key**: `azure_config_object`
- **Format**: URL-encoded JSON containing Azure configuration
- **Security**: Encrypted storage of sensitive data

#### Environment Variables

- **Primary**: `AZURE_API_KEY` environment variable
- **Fallback**: Used when cookie configuration is unavailable
- **Priority**: Cookie configuration takes precedence

### Authentication Flow

1. User configures Azure settings through the web interface
2. Configuration is encrypted and stored in cookies
3. API endpoints validate configuration from cookies
4. Fallback to environment variables if needed

## üì° Base URL

All API endpoints are relative to your application's base URL:

```
https://your-domain.com/api/
```

## üñºÔ∏è Image Generation API

### POST /api/generate

Generate images using Azure AI models.

#### Request Body

```json
{
  "deploymentId": "string",
  "prompt": "string",
  "size": "1024x1024" | "1024x1792" | "1792x1024",
  "outputFormat": "png" | "jpeg",
  "count": "number",
  "mode": "generate" | "edit",
  "image": "base64_string",
  "mask": "base64_string"
}
```

#### Parameters

- **deploymentId** (required): Azure deployment identifier
- **prompt** (required): Text description for image generation
- **size** (optional): Image dimensions (default: "1024x1024")
- **outputFormat** (optional): Output format (default: "png")
- **count** (optional): Number of images to generate (default: 1)
- **mode** (optional): Generation mode (default: "generate")
- **image** (required for edit): Base64 encoded image for editing
- **mask** (optional): Base64 encoded mask for selective editing

#### Response

```json
{
  "success": true,
  "data": {
    "images": [
      {
        "url": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
        "width": 1024,
        "height": 1024,
        "format": "png"
      }
    ],
    "generationTime": 2.5,
    "model": "dalle-3",
    "prompt": "a beautiful sunset over mountains"
  }
}
```

#### Error Responses

```json
{
  "error": "Azure is not configured, Please configure Azure first from settings",
  "status": 500
}
```

## üîß Configuration API

### GET /api/config

Retrieve current Azure configuration and validation status.

#### Response

```json
{
  "success": true,
  "data": {
    "hasApiKey": true,
    "endpoints": [
      {
        "name": "DALL-E 3",
        "deploymentId": "dalle-3",
        "baseUrl": "https://your-resource.openai.azure.com/",
        "apiVersion": "2024-02-15-preview"
      }
    ],
    "models": [
      {
        "id": "dalle-3",
        "name": "DALL-E 3",
        "type": "image-generation",
        "maxTokens": 1000
      }
    ],
    "errors": []
  }
}
```

### GET /api/app-config

Retrieve application configuration and metadata.

#### Response

```json
{
  "success": true,
  "data": {
    "name": "Image Studio",
    "version": "1.0.1",
    "description": "AI-powered image generation and editing platform",
    "features": [
      "image-generation",
      "image-editing",
      "asset-management",
      "project-management"
    ]
  }
}
```

## üé® Asset Store API

### GET /api/asset-store/search

Search for assets from external providers.

#### Query Parameters

- **query** (required): Search term
- **provider** (optional): "pexels" | "unsplash"
- **page** (optional): Page number (default: 1)
- **per_page** (optional): Items per page (default: 20)
- **orientation** (optional): "landscape" | "portrait" | "square"
- **color** (optional): Dominant color filter

#### Response

```json
{
  "success": true,
  "data": {
    "assets": [
      {
        "id": "12345",
        "url": "https://example.com/image.jpg",
        "thumbnail": "https://example.com/thumb.jpg",
        "width": 1920,
        "height": 1080,
        "photographer": "John Doe",
        "attribution": "Photo by John Doe on Unsplash"
      }
    ],
    "pagination": {
      "page": 1,
      "per_page": 20,
      "total": 100,
      "total_pages": 5
    }
  }
}
```

### GET /api/asset-store/categories

Retrieve available asset categories.

#### Response

```json
{
  "success": true,
  "data": {
    "categories": [
      {
        "id": "nature",
        "name": "Nature",
        "count": 1500,
        "thumbnail": "https://example.com/nature-thumb.jpg"
      },
      {
        "id": "business",
        "name": "Business",
        "count": 800,
        "thumbnail": "https://example.com/business-thumb.jpg"
      }
    ]
  }
}
```

### GET /api/asset-store/featured

Retrieve featured assets.

#### Response

```json
{
  "success": true,
  "data": {
    "featured": [
      {
        "id": "featured-1",
        "title": "Featured Collection",
        "assets": [
          {
            "id": "12345",
            "url": "https://example.com/featured1.jpg",
            "thumbnail": "https://example.com/featured1-thumb.jpg"
          }
        ]
      }
    ]
  }
}
```

## ü§ñ Azure Integration API

### GET /api/azure/models

Retrieve available Azure AI models.

#### Response

```json
{
  "success": true,
  "data": {
    "models": [
      {
        "id": "dalle-3",
        "name": "DALL-E 3",
        "type": "image-generation",
        "description": "Advanced image generation model",
        "maxTokens": 1000,
        "supportedSizes": ["1024x1024", "1024x1792", "1792x1024"]
      },
      {
        "id": "flux-1.1-pro",
        "name": "FLUX 1.1 Pro",
        "type": "image-generation",
        "description": "Creative AI model for artistic generation",
        "maxTokens": 2000,
        "supportedSizes": ["1024x1024", "1024x1792", "1792x1024"]
      }
    ]
  }
}
```

### POST /api/azure/validate

Validate Azure configuration and credentials.

#### Request Body

```json
{
  "apiKey": "your-api-key",
  "endpoint": "https://your-resource.openai.azure.com/",
  "deploymentId": "dalle-3"
}
```

#### Response

```json
{
  "success": true,
  "data": {
    "valid": true,
    "message": "Configuration is valid",
    "model": "dalle-3",
    "capabilities": ["image-generation", "image-editing"]
  }
}
```

## üõ†Ô∏è Background Removal API

### POST /api/background-removal

Remove background from images using AI.

#### Request Body

```json
{
  "image": "base64_string",
  "format": "png" | "jpeg",
  "quality": "high" | "medium" | "low"
}
```

#### Response

```json
{
  "success": true,
  "data": {
    "processedImage": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
    "originalSize": {
      "width": 1024,
      "height": 1024
    },
    "processingTime": 1.2
  }
}
```

## üîê Authentication API

### POST /api/auth/login

Authenticate user and establish session.

#### Request Body

```json
{
  "username": "admin",
  "password": "0000"
}
```

#### Response

```json
{
  "success": true,
  "data": {
    "authenticated": true,
    "user": {
      "username": "admin",
      "role": "admin"
    },
    "session": "session-token"
  }
}
```

## üìä Version API

### GET /api/version

Retrieve application version information.

#### Response

```json
{
  "success": true,
  "data": {
    "version": "1.0.1",
    "build": "2025.09.10",
    "environment": "production",
    "features": [
      "image-generation",
      "image-editing",
      "asset-management",
      "project-management",
      "cli-tools"
    ]
  }
}
```

## üö® Error Handling

### Standard Error Response Format

```json
{
  "error": "Error message description",
  "status": 400,
  "details": {
    "field": "specific field error",
    "code": "ERROR_CODE"
  }
}
```

### Common Error Codes

- **400**: Bad Request - Invalid parameters
- **401**: Unauthorized - Authentication required
- **403**: Forbidden - Insufficient permissions
- **404**: Not Found - Resource not found
- **429**: Too Many Requests - Rate limit exceeded
- **500**: Internal Server Error - Server error
- **503**: Service Unavailable - Azure service unavailable

## üîÑ Rate Limiting

### Rate Limits

- **Image Generation**: 10 requests per minute
- **Asset Search**: 60 requests per minute
- **Configuration**: 30 requests per minute
- **Background Removal**: 20 requests per minute

### Rate Limit Headers

```
X-RateLimit-Limit: 10
X-RateLimit-Remaining: 8
X-RateLimit-Reset: 1640995200
```

## üìù Request/Response Examples

### Complete Image Generation Flow

#### 1. Check Configuration

```bash
curl -X GET "https://your-domain.com/api/config" \
  -H "Cookie: azure_config_object=encoded_config"
```

#### 2. Generate Image

```bash
curl -X POST "https://your-domain.com/api/generate" \
  -H "Content-Type: application/json" \
  -H "Cookie: azure_config_object=encoded_config" \
  -d '{
    "deploymentId": "dalle-3",
    "prompt": "a beautiful sunset over mountains",
    "size": "1024x1024",
    "count": 1
  }'
```

#### 3. Process Response

```javascript
const response = await fetch("/api/generate", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    Cookie: "azure_config_object=encoded_config",
  },
  body: JSON.stringify({
    deploymentId: "dalle-3",
    prompt: "a beautiful sunset over mountains",
    size: "1024x1024",
  }),
});

const data = await response.json();
if (data.success) {
  const imageUrl = data.data.images[0].url;
  // Use the generated image
}
```

## üîß SDK Integration

### JavaScript/TypeScript

```typescript
class AzureImageStudioAPI {
  private baseUrl: string;
  private config: string;

  constructor(baseUrl: string, config: string) {
    this.baseUrl = baseUrl;
    this.config = config;
  }

  async generateImage(prompt: string, options: GenerationOptions) {
    const response = await fetch(`${this.baseUrl}/api/generate`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Cookie: `azure_config_object=${this.config}`,
      },
      body: JSON.stringify({
        deploymentId: options.model,
        prompt,
        size: options.size,
        count: options.count || 1,
      }),
    });

    return response.json();
  }
}
```

### Python

```python
import requests
import json

class AzureImageStudioAPI:
    def __init__(self, base_url, config):
        self.base_url = base_url
        self.config = config
        self.session = requests.Session()
        self.session.cookies.set('azure_config_object', config)

    def generate_image(self, prompt, **options):
        response = self.session.post(
            f"{self.base_url}/api/generate",
            json={
                'deploymentId': options.get('model', 'dalle-3'),
                'prompt': prompt,
                'size': options.get('size', '1024x1024'),
                'count': options.get('count', 1)
            }
        )
        return response.json()
```

## üõ°Ô∏è Security Considerations

### API Security

- **HTTPS Only**: All API calls must use HTTPS
- **Input Validation**: All inputs are validated and sanitized
- **Rate Limiting**: Prevents abuse and ensures fair usage
- **Error Handling**: Sensitive information is not exposed in errors

### Data Protection

- **Encryption**: Sensitive data is encrypted in transit and at rest
- **No Logging**: API keys and sensitive data are not logged
- **Secure Storage**: Configuration is stored securely in encrypted cookies

## üìö Related Documentation

- **[Installation Guide](installation-guide.mdx)** - Setting up the application
- **[Azure Setup Guide](azure-setup-guide.mdx)** - Configuring Azure services
- **[CLI Guide](cli-guide.mdx)** - Command-line interface
- **[Technical Architecture](technical-architecture.mdx)** - System architecture
- **[Troubleshooting Guide](troubleshooting-guide.mdx)** - Common issues

---

**Author**: Hazem Ali - Microsoft AI MVP  
**Last Updated**: September 2025

_For additional support, visit our [GitHub Discussions](https://github.com/DrHazemAli/image-studio/discussions) or [report issues](https://github.com/DrHazemAli/image-studio/issues)._
